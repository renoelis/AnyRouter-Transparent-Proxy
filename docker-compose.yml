version: '3.8'

services:
  anthropic-proxy:
    build: .
    container_name: anthropic-proxy
    ports:
      - "8088:8088"
    environment:
      # 可以在这里直接设置环境变量，或者使用 .env 文件
      - API_BASE_URL=${API_BASE_URL:-https://anyrouter.top}
      - SYSTEM_PROMPT_REPLACEMENT=${SYSTEM_PROMPT_REPLACEMENT:-You are Claude Code, Anthropic's official CLI for Claude.}
    env_file:
      - .env  # 如果存在 .env 文件,会自动加载
    # 配置 DNS 服务器,绕过 VPN 的 DNS 污染
    dns:
      - 1.1.1.1    # Cloudflare DNS
      - 8.8.8.8    # Google DNS
    volumes:
      # 挂载自定义 Header 配置文件（可选）
      - ./env/:/app/env/
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import httpx; httpx.get('http://localhost:8088/', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s